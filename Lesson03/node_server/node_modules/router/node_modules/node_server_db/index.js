const MongoClient = require('mongodb').MongoClient;
const mongoClient = new MongoClient("mongodb://localhost:27017", {useNewUrlParser: true, useUnifiedTopology: true});

var DB = {
	insert: function(table, d, callbak){
		var data = [];
		if (typeof d != 'object') return false;
		if (d.length) data = d; else data.push(d);

		var collection = this.db.collection(table);
		collection.insertMany(data, function(err, res){
			callbak(err, res);
		});
	},
	delete: function(table, filter, callbak){
		var collection = this.db.collection(table);
		collection
		.deleteMany(filter)
		.then(res => callbak(false, res))
		.catch(err => callbak(err, false));
	},
	update: function(table, filter, data, callbak){
		var collection = this.db.collection(table);
		collection
		.updateMany(filter, {$set: data}, )
		.then(res => callbak(false, res))
		.catch(err => callbak(err, false));
		/*	
		.findOneAndUpdate(
			filter,
			{$set: data},
			{returnOriginal: false},
			callbak //по документации там есть err, res
		);*/
	},
	select: function(table, d, callbak){
		d = d || {};
		var collection = this.db.collection(table);
		collection.find(d).toArray(function(err, res){
			callbak(err, res);
		});
	},
	init: function(dbname) {
		var self = this;
		mongoClient.connect(function(err, client){
			self.client = client;
			self.db = self.client.db(dbname);
		});		
	}
};

module.exports = DB;